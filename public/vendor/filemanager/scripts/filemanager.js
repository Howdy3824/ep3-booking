(function(C){C.urlParam=function(X){var Y=new RegExp("[\\?&]"+X+"=([^&#]*)").exec(window.location.href);if(Y){return Y[1]}else{return 0}};var L=function(Z){var Y=null;Z=(typeof Z==="undefined")?"user":Z;if(Z=="user"){var X="./scripts/filemanager.config.js"}else{var X="./scripts/filemanager.config.js.default"}C.ajax({async:false,url:X,dataType:"json",cache:false,success:function(aa){Y=aa}});return Y};var t=L("default");var F=L();var F=C.extend({},t,F);HEAD_included_files=new Array();loadCSS=function(Y){if(C.inArray(Y,HEAD_included_files)==-1){var X=C("<link rel='stylesheet' type='text/css' href='"+Y+"'>");C("head").append(X);HEAD_included_files.push(Y)}};loadJS=function(Y){if(C.inArray(Y,HEAD_included_files)==-1){var X=C("<script type='text/javascript' src='"+Y+"'>");C("head").append(X);HEAD_included_files.push(Y)}};var D=F.options.fileConnector||"connectors/"+F.options.lang+"/filemanager."+F.options.lang;var y=F.options.capabilities||new Array("select","download","rename","move","delete","replace");if(C.urlParam("langCode")!=0&&x("scripts/languages/"+C.urlParam("langCode")+".js")){F.options.culture=C.urlParam("langCode")}var E=[];C.ajax({url:"scripts/languages/"+F.options.culture+".js",async:false,dataType:"json",success:function(X){E=X}});C.prompt.setDefaults({overlayspeed:"fast",show:"fadeIn",opacity:0.4,persistent:false});var J=function(){var X=20;if(F.options.searchBox===true){X+=33}if(C.urlParam("CKEditorCleanUpFuncNum")){X+=60}var Y=C(window).height()-C("#uploader").height()-X;C("#splitter, #filetree, #fileinfo, .vsplitbar").height(Y);var Z=C("#splitter").width()-6-C("#filetree").width();C("#fileinfo").width(Z)};var e=function(X,Y){Y=(typeof Y==="undefined")?true:false;if(F.options.showFullPath==false){if("function"===typeof displayPathDecorator){return displayPathDecorator(X.replace(fileRoot,"/"))}else{X=X.replace(fileRoot,"/");if(X.length>50&&Y===true){var Z=X.split("/");X="/"+Z[1]+"/"+Z[2]+"/(...)/"+Z[Z.length-2]+"/"}return X}}else{return X}};var h=function(X){if(X=="grid"){C("#grid").addClass("ON");C("#list").removeClass("ON")}else{C("#list").addClass("ON");C("#grid").removeClass("ON")}};function x(X){var Y=this.window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest();if(!Y){throw new Error("XMLHttpRequest not supported")}Y.open("HEAD",X,false);Y.send(null);if(Y.status==200){return true}return false}var O=function(aa,ab,ac){var X=String(ac);for(i=0;i<aa.length;i++){var Z=RegExp(aa[i],"g");var Y=ab[i];X=X.replace(Z,Y)}return X};var m=function(Z){var Y="";var aa=new Array("Š","š","Đ","đ","Ž","ž","Č","č","Ć","ć","À","Á","Â","Ã","Ä","Å","Æ","Ç","È","É","Ê","Ë","Ì","Í","Î","Ï","Ñ","Ò","Ó","Ô","Õ","Ö","Ő","Ø","Ù","Ú","Û","Ü","Ý","Þ","ß","à","á","â","ã","ä","å","æ","ç","è","é","ê","ë","ì","í","î","ï","ð","ñ","ò","ó","ô","õ","ö","ő","ø","ù","ú","û","ü","ý","ý","þ","ÿ","Ŕ","ŕ"," ","'","/");var X=new Array("S","s","Dj","dj","Z","z","C","c","C","c","A","A","A","A","A","A","A","C","E","E","E","E","I","I","I","I","N","O","O","O","O","O","O","O","U","U","U","U","Y","B","Ss","a","a","a","a","a","a","a","c","e","e","e","e","i","i","i","i","o","n","o","o","o","o","o","o","o","u","u","u","u","y","y","b","y","R","r","_","_","");Y=O(aa,X,Z);if(F.options.chars_only_latin){Y=Y.replace(/[^_a-zA-Z0-9]/g,"")}Y=Y.replace(/[_]+/g,"_");return Y};var W=function(X){filename="";if(X.lastIndexOf(".")!=-1){filename=m(X.substr(0,X.lastIndexOf(".")));filename+="."+X.split(".").pop()}else{filename=m(X)}return filename};var K=function(X){var ab=parseFloat(X);var Z=parseFloat(1024);var aa=0;var Y=[E.bytes,E.kb,E.mb,E.gb];while(true){if(ab<Z){ab=Math.round(ab*100)/100;return ab+Y[aa]}else{ab/=Z;aa+=1}}};var Q=function(X){C("#fileinfo").html("<h1>"+X+"</h1>");C("#newfile").attr("disabled","disabled");C("#upload").attr("disabled","disabled");C("#newfolder").attr("disabled","disabled")};function d(Y,X){if(Y["File Type"]=="dir"&&(X=="download"||X=="replace")){return false}if(typeof(Y.Capabilities)=="undefined"){return true}else{return C.inArray(X,Y.Capabilities)>-1}}var H=function(X){if(F.security.uploadPolicy=="DISALLOW_ALL"){if(C.inArray(r(X),F.security.uploadRestrictions)!=-1){return true}}if(F.security.uploadPolicy=="ALLOW_ALL"){if(C.inArray(r(X),F.security.uploadRestrictions)==-1){return true}}return false};var P=function(Z,Y){var X=Z.replace(/^.*[\/\\]/g,"");if(typeof(Y)=="string"&&X.substr(X.length-Y.length)==Y){X=X.substr(0,X.length-Y.length)}return X};var r=function(X){if(X.split(".").length==1){return""}return X.split(".").pop().toLowerCase()};var w=function(X){if(X.lastIndexOf(".")!=-1){return X.substring(0,X.lastIndexOf("."))}else{return X}};var s=function(X){if(C.inArray(r(X),F.edit.editExt)!=-1){return true}else{return false}};var q=function(X){if(C.inArray(r(X),F.images.imagesExt)!=-1){return true}else{return false}};var M=function(X){if(C.inArray(r(X),F.videos.videosExt)!=-1){return true}else{return false}};var N=function(X){if(C.inArray(r(X),F.audios.audiosExt)!=-1){return true}else{return false}};var S=function(Y){var X="<video width="+F.videos.videosPlayerWidth+" height="+F.videos.videosPlayerHeight+' src="'+Y.Path+'" controls="controls">';X+='<img src="'+Y.Preview+'" />';X+="</video>";C("#fileinfo img").remove();C("#fileinfo #preview h1").before(X)};var A=function(Y){var X='<audio src="'+Y.Path+'" controls="controls">';X+='<img src="'+Y.Preview+'" />';X+="</audio>";C("#fileinfo img").remove();C("#fileinfo #preview h1").before(X)};var b=function(X){C("#fileinfo").find("td:first-child").each(function(){var Y=C(this).attr("data-path");var Z=C("#filetree").find('a[data-path="'+Y+'"]').parent();if(typeof Z.css("background-image")!=="undefined"){C(this).css("background-image",Z.css("background-image"));window.clearInterval(X)}})};var V=function(X){C("#currentpath").val(X);C("#uploader h1").text(E.current_folder+e(X)).attr("title",e(X,false)).attr("data-path",X);C("#newfolder").unbind().click(function(){var Y=E.default_foldername;var ab=E.prompt_foldername+' : <input id="fname" name="fname" type="text" value="'+Y+'" />';var Z=function(ad,ac){if(ad!=1){return false}var af=ac.children("#fname").val();if(af!=""){Y=m(af);var ae=new Date();C.getJSON(D+"?mode=addfolder&path="+C("#currentpath").val()+"&name="+Y+"&time="+ae.getMilliseconds(),function(ag){if(ag.Code==0){G(ag.Parent,ag.Name);v(ag.Parent);C("#filetree").find('a[data-path="'+ag.Parent+'/"]').click().click()}else{C.prompt(ag.Error)}})}else{C.prompt(E.no_foldername)}};var aa={};aa[E.create_folder]=true;aa[E.cancel]=false;C.prompt(ab,{callback:Z,buttons:aa})})};var z=function(X){C("#fileinfo button").each(function(Y){if(C(this).find("span").length==0){C(this).wrapInner("<span></span>")}});if(!d(X,"select")){C("#fileinfo").find("button#select").hide()}else{C("#fileinfo").find("button#select").click(function(){p(X)}).show();if(window.opener||window.tinyMCEPopup){C("#preview img").attr("title",E.select);C("#preview img").click(function(){p(X)}).css("cursor","pointer")}}if(!d(X,"rename")){C("#fileinfo").find("button#rename").hide()}else{C("#fileinfo").find("button#rename").click(function(){var Y=B(X);if(Y.length){C("#fileinfo > h1").text(Y)}}).show()}if(!d(X,"move")){C("#fileinfo").find("button#move").hide()}else{C("#fileinfo").find("button#move").click(function(){var Y=u(X);if(Y.length){C("#fileinfo > h1").text(Y)}}).show()}if(!d(X,"replace")){C("#fileinfo").find("button#replace").hide()}else{C("#fileinfo").find("button#replace").click(function(){c(X)}).show()}if(!d(X,"delete")){C("#fileinfo").find("button#delete").hide()}else{C("#fileinfo").find("button#delete").click(function(){if(g(X)){C("#fileinfo").html("<h1>"+E.select_from_left+"</h1>")}}).show()}if(!d(X,"download")){C("#fileinfo").find("button#download").hide()}else{C("#fileinfo").find("button#download").click(function(){window.location=D+"?mode=download&path="+encodeURIComponent(X.Path)}).show()}};var f=function(){C("#filetree").fileTree({root:fileRoot,datafunc:T,multiFolder:false,folderCallback:function(X){v(X)},expandedFolder:fullexpandedFolder,after:function(X){C("#filetree").find("li a").each(function(){C(this).contextMenu({menu:k(C(this))},function(Z,Y,ab){var aa=C(Y).attr("data-path");o(Z,aa)})});if(F.options.searchBox==true){C("#q").liveUpdate("#filetree ul").blur();C("#search span.q-inactive").html(E.search);C("#search a.q-reset").attr("title",E.search_reset)}}},function(X){U(X)})};var p=function(aa){if(F.options.relPath!==false){var Y=relPath+aa.Path.replace(fileRoot,"")}else{var Y=relPath+aa.Path}if(window.opener||window.tinyMCEPopup||C.urlParam("field_name")||C.urlParam("CKEditorCleanUpFuncNum")||C.urlParam("CKEditor")){if(window.tinyMCEPopup){var ac=tinyMCEPopup.getWindowArg("window");ac.document.getElementById(tinyMCEPopup.getWindowArg("input")).value=Y;if(typeof(ac.ImageDialog)!="undefined"){if(ac.ImageDialog.getImageData){ac.ImageDialog.getImageData()}if(ac.ImageDialog.showPreviewImage){ac.ImageDialog.showPreviewImage(Y)}}tinyMCEPopup.close();return}if(C.urlParam("field_name")){parent.document.getElementById(C.urlParam("field_name")).value=Y;if(typeof parent.tinyMCE!=="undefined"){parent.tinyMCE.activeEditor.windowManager.close()}if(typeof parent.$.fn.colorbox!=="undefined"){parent.$.fn.colorbox.close()}}else{if(C.urlParam("CKEditor")){if(window.opener){window.opener.CKEDITOR.tools.callFunction(C.urlParam("CKEditorFuncNum"),Y)}else{parent.CKEDITOR.tools.callFunction(C.urlParam("CKEditorFuncNum"),Y);parent.CKEDITOR.tools.callFunction(C.urlParam("CKEditorCleanUpFuncNum"))}}else{if(aa.Properties["Width"]!=""){var ab=Y;var X=aa.Properties["Width"];var Z=aa.Properties["Height"];window.opener.SetUrl(ab,X,Z)}else{window.opener.SetUrl(Y)}}}if(window.opener){window.close()}}else{C.prompt(E.fck_select_integration)}};var B=function(aa){var Z="";var ac=F.security.allowChangeExtensions?aa.Filename:w(aa.Filename);var ab=E.new_filename+' : <input id="rname" name="rname" type="text" value="'+ac+'" />';var X=function(ae,ad){if(ae!=1){return false}rname=ad.children("#rname").val();if(rname!=""){var af=rname;if(!F.security.allowChangeExtensions){af=W(rname);var ag=r(aa.Filename);if(ag.length>0){af=af+"."+ag}}if(aa.Path.charAt(aa.Path.length-1)!="/"&&!H(af)){var ai="<p>"+E.INVALID_FILE_TYPE+"</p>";if(F.security.uploadPolicy=="DISALLOW_ALL"){ai+="<p>"+E.ALLOWED_FILE_TYPE+F.security.uploadRestrictions.join(", ")+".</p>"}if(F.security.uploadPolicy=="ALLOW_ALL"){ai+="<p>"+E.DISALLOWED_FILE_TYPE+F.security.uploadRestrictions.join(", ")+".</p>"}C("#filepath").val("");C.prompt(ai);return false}var aj=aa.Path;var ah=D+"?mode=rename&old="+aa.Path+"&new="+af;C.ajax({type:"GET",url:ah,dataType:"json",async:false,success:function(ak){if(ak.Code==0){var am=ak["New Path"];var al=ak["New Name"];I(aj,am,al);var an=C("#preview h1").attr("title");if(typeof an!="undefined"&&an==aj){C("#preview h1").text(al)}if(C("#fileinfo").data("view")=="grid"){C('#fileinfo img[data-path="'+aj+'"]').parent().next("p").text(al);C('#fileinfo img[data-path="'+aj+'"]').attr("data-path",am)}else{C('#fileinfo td[data-path="'+aj+'"]').text(al);C('#fileinfo td[data-path="'+aj+'"]').attr("data-path",am)}C("#preview h1").html(al);aa.Path=am;aa.Filename=al;C("#fileinfo").find("button#rename, button#delete, button#download").unbind();z(aa);if(F.options.showConfirmation){C.prompt(E.successful_rename)}}else{C.prompt(ak.Error)}Z=ak["New Name"]}})}};var Y={};Y[E.rename]=true;Y[E.cancel]=false;C.prompt(ab,{callback:X,buttons:Y});return Z};var c=function(X){C("#fileR").bind("change",function(){C(this).closest("form#toolbar").submit()});C("#toolbar").attr("action",D);C("#toolbar").attr("method","post");C("#toolbar").ajaxForm({target:"#uploadresponse",beforeSubmit:function(Y,ac,aa){var Z=C("#fileR",ac).val();if(Z==""){return false}if(r(Z)!=X["File Type"]){C.prompt(E.ERROR_REPLACING_FILE+" ."+r(X.Filename));return false}C("#replace").attr("disabled",true);C("#upload span").addClass("loading").text(E.loading_data);if(typeof FileReader!=="undefined"&&typeof F.upload.fileSizeLimit!="auto"){var ab=C("#fileR",ac).get(0).files[0].size;if(ab>F.upload.fileSizeLimit*1024*1024){C.prompt("<p>"+E.file_too_big+"</p><p>"+E.file_size_limit+F.upload.fileSizeLimit+" "+E.mb+".</p>");C("#upload").removeAttr("disabled").find("span").removeClass("loading").text(E.upload);return false}}},error:function(Y,aa,Z){C("#upload").removeAttr("disabled").find("span").removeClass("loading").text(E.upload);C.prompt(E.ERROR_UPLOADING_FILE)},success:function(Y){var aa=jQuery.parseJSON(C("#uploadresponse").find("textarea").text());if(aa.Code==0){var Z=aa.Path+"/"+aa.Name;U(Z);C("#preview").find("img").hide().fadeIn("slow");C("ul.jqueryFileTree").find('li a[data-path="'+Z+'"]').parent().hide().fadeIn("slow");if(F.options.showConfirmation){C.prompt(E.successful_replace)}}else{C.prompt(aa.Error)}C("#replace").removeAttr("disabled");C("#upload span").removeClass("loading").text(E.upload)}});C("#newfilepath").val(X.Path);C("#fileR").click()};var u=function(aa){var Z="";var ab=E.move+' : <input id="rname" name="rname" type="text" value="" />';var X=function(ad,ac){if(ad!=1){return false}rname=ac.children("#rname").val();if(rname!=""){var ae=rname;var ag=aa.Path;var af=D+"?mode=move&old="+encodeURIComponent(aa.Path)+"&new="+encodeURIComponent(ae)+"&root="+encodeURIComponent(fileRoot);C.ajax({type:"GET",url:af,dataType:"json",async:false,success:function(ah){if(ah.Code==0){var aj=ah["New Path"];var ai=ah["New Name"];fullexpandedFolder=aj;f();v(aj);if(F.options.showConfirmation){C.prompt(E.successful_moved)}}else{C.prompt(ah.Error)}Z=aj+ai}})}};var Y={};Y[E.move]=true;Y[E.cancel]=false;C.prompt(ab,{callback:X,buttons:Y});return Z};var g=function(aa){var X=false;var ab=E.confirmation_delete;var Z=function(ad,ac){if(ad!=1){return false}var ag=new Date();var af=D+"?mode=delete&path="+encodeURIComponent(aa.Path)+"&time="+ag.getMilliseconds(),ae=aa.Path.split("/").reverse().slice(1).reverse().join("/")+"/";C.ajax({type:"GET",url:af,dataType:"json",async:false,success:function(ah){if(ah.Code==0){l(ah.Path);var ai=ah.Path.substring(0,ah.Path.length-1);ai=ai.substr(0,ai.lastIndexOf("/")+1);C("#uploader h1").text(E.current_folder+e(ai)).attr("title",e(ai,false)).attr("data-path",ai);X=true;if(F.options.showConfirmation){C.prompt(E.successful_delete)}C("#filetree").find('a[data-path="'+ae+'/"]').click().click()}else{X=false;C.prompt(ah.Error)}}})};var Y={};Y[E.yes]=true;Y[E.no]=false;C.prompt(ab,{callback:Z,buttons:Y});return X};var a=function(X){isEdited=false;C("#fileinfo").find("h1").append(' <a id="edit-file" href="#" title="'+E.edit+'"><span>'+E.edit+"</span></a>");C("#edit-file").click(function(){C(this).hide();var Z=new Date();var Y=D+"?mode=editfile&path="+encodeURIComponent(X.Path)+"&time="+Z.getMilliseconds();C.ajax({type:"GET",url:Y,dataType:"json",async:false,success:function(aa){if(aa.Code==0){var ab='<form id="edit-form">';ab+='<textarea id="edit-content" name="content">'+aa.Content+"</textarea>";ab+='<input type="hidden" name="mode" value="savefile" />';ab+='<input type="hidden" name="path" value="'+X.Path+'" />';ab+='<button id="edit-cancel" class="edition" type="button">'+E.quit_editor+"</button>";ab+='<button id="edit-save" class="edition" type="button">'+E.save+"</button>";ab+="</form>";C("#preview").find("img").hide();C("#preview").prepend(ab).hide().fadeIn();C("#edit-cancel").click(function(){C("#preview").find("form#edit-form").hide();C("#preview").find("img").fadeIn();C("#edit-file").show()});C("#edit-save").click(function(){var ad=codeMirrorEditor.getValue();C("textarea#edit-content").val(ad);var ac=C("#edit-form").serializeArray();C.ajax({type:"POST",url:D,dataType:"json",data:ac,async:false,success:function(ae){if(ae.Code==0){isEdited=true;C.prompt(E.successful_edit)}else{isEdited=false;C.prompt(ae.Error)}}})});codeMirrorEditor=instantiateCodeMirror(r(X.Path),F)}else{isEdited=false;C.prompt(aa.Error);C(this).show()}}})});return isEdited};var R=function(ac,Y){var ab=r(Y);var aa=C("#filetree").find('a[data-path="'+ac+'"]');var X=aa.parent();var Z='<li class="file ext_'+ab+'"><a data-path="'+ac+Y+'" href="#" class="">'+Y+"</a></li>";if(!X.find("ul").size()){X=C("#filetree").find("ul.jqueryFileTree");X.prepend(Z);f()}else{X.find("ul").prepend(Z);aa.click().click()}v(ac);if(F.options.showConfirmation){C.prompt(E.successful_added_file)}};var I=function(ab,aa,Y){var Z=C("#filetree").find('a[data-path="'+ab+'"]');var X=Z.parent().parent().prev("a");Z.attr("data-path",aa).text(Y);if(X.length==0){f()}else{X.click().click()}};var l=function(Z){C("#filetree").find('a[data-path="'+Z+'"]').parent().fadeOut("slow",function(){C(this).remove()});if(C("#uploader h1").attr("data-path")==Z){var X=Z.split("/");var Y=X.slice(0,length-2).join("/")+"/";v(Y)}if(C("#fileinfo").data("view")=="grid"){C('#contents img[data-path="'+Z+'"]').parent().parent().fadeOut("slow",function(){C(this).remove()})}else{C("table#contents").find('td[data-path="'+Z+'"]').parent().fadeOut("slow",function(){C(this).remove()})}if(C("#preview").length){v(Z.substr(0,Z.lastIndexOf("/")+1))}};var G=function(aa,Y){var Z='<li class="directory collapsed"><a data-path="'+aa+Y+'/" href="#">'+Y+'</a><ul class="jqueryFileTree" style="display: block;"></ul></li>';var X=C("#filetree").find('a[data-path="'+aa+'"]');if(aa!=fileRoot){X.next("ul").prepend(Z).prev("a").click().click()}else{C("#filetree > ul").prepend(Z);C("#filetree").find('li a[data-path="'+aa+Y+'/"]').attr("class","cap_rename cap_delete").click(function(){v(aa+Y+"/")}).each(function(){C(this).contextMenu({menu:k(C(this))},function(ac,ab,ae){var ad=C(ab).attr("data-path");o(ac,ad)})})}if(F.options.showConfirmation){C.prompt(E.successful_added_folder)}};var n=function(X){if(X.lastIndexOf("/")==X.length-1){v(X);C("#filetree").find('a[data-path="'+X+'"]').click()}else{U(X)}};function k(Y){var X=Y.attr("class").replace(/ /g,"_");if(X==""){return"itemOptions"}if(!(C("#"+X).length)){var Z=C("#itemOptions").clone().attr("id",X);if(!Y.hasClass("cap_select")){C(".select",Z).remove()}if(!Y.hasClass("cap_download")){C(".download",Z).remove()}if(!Y.hasClass("cap_rename")){C(".rename",Z).remove()}if(!Y.hasClass("cap_move")){C(".move",Z).remove()}C(".replace",Z).remove();if(!Y.hasClass("cap_delete")){C(".delete",Z).remove()}C("#itemOptions").after(Z)}return X}var o=function(X,Y){var Z=new Date();C.getJSON(D+"?mode=getinfo&path="+Y+"&time="+Z.getMilliseconds(),function(ac){if(C("#fileinfo").data("view")=="grid"){var ab=C("#fileinfo").find('img[data-path="'+ac.Path+'"]').parent()}else{var ab=C("#fileinfo").find('td[data-path="'+ac.Path+'"]').parent()}switch(X){case"select":p(ac);break;case"download":window.location=D+"?mode=download&path="+ac.Path+"&time="+Z.getMilliseconds();break;case"rename":var aa=B(ac);break;case"replace":c(ac);break;case"move":var aa=u(ac);break;case"delete":g(ac);break}})};var U=function(X){var aa=X.substr(0,X.lastIndexOf("/")+1);V(aa);var Y='<div id="preview"><img /><h1></h1><dl></dl></div>';Y+='<form id="toolbar">';Y+='<button id="parentfolder">'+E.parentfolder+"</button>";if(C.inArray("select",y)!=-1&&(C.urlParam("CKEditor")||window.opener||window.tinyMCEPopup||C.urlParam("field_name"))){Y+='<button id="select" name="select" type="button" value="Select">'+E.select+"</button>"}if(C.inArray("download",y)!=-1){Y+='<button id="download" name="download" type="button" value="Download">'+E.download+"</button>"}if(C.inArray("rename",y)!=-1&&F.options.browseOnly!=true){Y+='<button id="rename" name="rename" type="button" value="Rename">'+E.rename+"</button>"}if(C.inArray("move",y)!=-1&&F.options.browseOnly!=true){Y+='<button id="move" name="move" type="button" value="Move">'+E.move+"</button>"}if(C.inArray("delete",y)!=-1&&F.options.browseOnly!=true){Y+='<button id="delete" name="delete" type="button" value="Delete">'+E.del+"</button>"}if(C.inArray("replace",y)!=-1&&F.options.browseOnly!=true){Y+='<button id="replace" name="replace" type="button" value="Replace">'+E.replace+"</button>";Y+='<div class="hidden-file-input"><input id="fileR" name="fileR" type="file" /></div>';Y+='<input id="mode" name="mode" type="hidden" value="replace" /> ';Y+='<input id="newfilepath" name="newfilepath" type="hidden" />'}Y+="</form>";C("#fileinfo").html(Y);C("#parentfolder").click(function(){v(aa)});var Z=new Date();C.getJSON(D+"?mode=getinfo&path="+encodeURIComponent(X)+"&time="+Z.getMilliseconds(),function(ac){if(ac.Code==0){C("#fileinfo").find("h1").text(ac.Filename).attr("title",X);C("#fileinfo").find("img").attr("src",ac.Preview);if(M(ac.Filename)&&F.videos.showVideoPlayer==true){S(ac)}if(N(ac.Filename)&&F.audios.showAudioPlayer==true){A(ac)}if(s(ac.Filename)&&F.edit.enabled==true){a(ac)}var ab="";if(ac.Properties["Width"]&&ac.Properties["Width"]!=""){ab+="<dt>"+E.dimensions+"</dt><dd>"+ac.Properties["Width"]+"x"+ac.Properties["Height"]+"</dd>"}if(ac.Properties["Date Created"]&&ac.Properties["Date Created"]!=""){ab+="<dt>"+E.created+"</dt><dd>"+ac.Properties["Date Created"]+"</dd>"}if(ac.Properties["Date Modified"]&&ac.Properties["Date Modified"]!=""){ab+="<dt>"+E.modified+"</dt><dd>"+ac.Properties["Date Modified"]+"</dd>"}if(ac.Properties["Size"]||parseInt(ac.Properties["Size"])==0){ab+="<dt>"+E.size+"</dt><dd>"+K(ac.Properties["Size"])+"</dd>"}C("#fileinfo").find("dl").html(ab);z(ac)}else{C.prompt(ac.Error)}})};var v=function(Y){V(Y);C("#fileinfo").html('<img id="activity" src="images/wait30trans.gif" width="30" height="30" />');var Z=new Date();var X=D+"?path="+encodeURIComponent(Y)+"&mode=getfolder&showThumbs="+F.options.showThumbs+"&time="+Z.getMilliseconds();if(C.urlParam("type")){X+="&type="+C.urlParam("type")}C.getJSON(X,function(ae){var aa="";if(ae.Code=="-1"){Q(ae.Error);return}if(ae){if(C("#fileinfo").data("view")=="grid"){aa+='<ul id="contents" class="grid">';for(key in ae){var ad=ae[key]["Properties"];var ab="";for(cap in y){if(d(ae[key],y[cap])){ab+=" cap_"+y[cap]}}var ac=64;var ag=ad.Width;if(ag>1&&ag<ac){ac=ag}F.options.showTitleAttr?title=' title="'+ae[key]["Path"]+'"':title="";aa+='<li class="'+ab+'"'+title+'"><div class="clip"><img src="'+ae[key]["Preview"]+'" width="'+ac+'" alt="'+ae[key]["Path"]+'" data-path="'+ae[key]["Path"]+'" /></div><p>'+ae[key]["Filename"]+"</p>";if(ad.Width&&ad.Width!=""){aa+='<span class="meta dimensions">'+ad.Width+"x"+ad.Height+"</span>"}if(ad.Size&&ad.Size!=""){aa+='<span class="meta size">'+ad.Size+"</span>"}if(ad["Date Created"]&&ad["Date Created"]!=""){aa+='<span class="meta created">'+ad["Date Created"]+"</span>"}if(ad["Date Modified"]&&ad["Date Modified"]!=""){aa+='<span class="meta modified">'+ad["Date Modified"]+"</span>"}aa+="</li>"}aa+="</ul>"}else{aa+='<table id="contents" class="list">';aa+='<thead><tr><th class="headerSortDown"><span>'+E.name+"</span></th><th><span>"+E.dimensions+"</span></th><th><span>"+E.size+"</span></th><th><span>"+E.modified+"</span></th></tr></thead>";aa+="<tbody>";for(key in ae){var af=ae[key]["Path"];var ad=ae[key]["Properties"];var ab="";F.options.showTitleAttr?title=' title="'+ae[key]["Path"]+'"':title="";for(cap in y){if(d(ae[key],y[cap])){ab+=" cap_"+y[cap]}}aa+='<tr class="'+ab+'">';aa+='<td data-path="'+ae[key]["Path"]+'"'+title+'">'+ae[key]["Filename"]+"</td>";if(ad.Width&&ad.Width!=""){aa+=("<td>"+ad.Width+"x"+ad.Height+"</td>")}else{aa+="<td></td>"}if(ad.Size&&ad.Size!=""){aa+='<td><abbr title="'+ad.Size+'">'+K(ad.Size)+"</abbr></td>"}else{aa+="<td></td>"}if(ad["Date Modified"]&&ad["Date Modified"]!=""){aa+="<td>"+ad["Date Modified"]+"</td>"}else{aa+="<td></td>"}aa+="</tr>"}aa+="</tbody>";aa+="</table>"}}else{aa+="<h1>"+E.could_not_retrieve_folder+"</h1>"}C("#fileinfo").html(aa);if(C("#fileinfo").data("view")=="grid"){C("#fileinfo").find("#contents li").click(function(){var ai=C(this).find("img").attr("data-path");n(ai)}).each(function(){C(this).contextMenu({menu:k(C(this))},function(aj,ai,al){var ak=C(ai).find("img").attr("data-path");o(aj,ak)})})}else{C("#fileinfo tbody tr").click(function(){var ai=C("td:first-child",this).attr("data-path");n(ai)}).each(function(){C(this).contextMenu({menu:k(C(this))},function(aj,ai,al){var ak=C("td:first-child",ai).attr("data-path");o(aj,ak)})});C("#fileinfo").find("table").tablesorter({textExtraction:function(ai){if(C(ai).find("abbr").size()){return C(ai).find("abbr").attr("title")}else{return ai.innerHTML}}});var ah=setInterval(function(){b(ah)},300)}})};var T=function(Y,aa){var Z=new Date();var X=D+"?path="+encodeURIComponent(Y)+"&mode=getfolder&showThumbs="+F.options.showThumbs+"&time="+Z.getMilliseconds();if(C.urlParam("type")){X+="&type="+C.urlParam("type")}C.getJSON(X,function(ad){var ab="";if(ad.Code=="-1"){Q(ad.Error);return}if(ad){ab+='<ul class="jqueryFileTree" style="display: none;">';for(key in ad){var ac="";for(cap in y){if(d(ad[key],y[cap])){ac+=" cap_"+y[cap]}}if(ad[key]["File Type"]=="dir"){ab+='<li class="directory collapsed"><a href="#" class="'+ac+'" data-path="'+ad[key]["Path"]+'">'+ad[key]["Filename"]+"</a></li>"}else{if(F.options.listFiles){ab+='<li class="file ext_'+ad[key]["File Type"].toLowerCase()+'"><a href="#" class="'+ac+'" data-path="'+ad[key]["Path"]+'">'+ad[key]["Filename"]+"</a></li>"}}}ab+="</ul>"}else{ab+="<h1>"+E.could_not_retrieve_folder+"</h1>"}aa(ab)})};C(function(){if(F.extras.extra_js){for(var X=0;X<F.extras.extra_js.length;X++){C.ajax({url:F.extras.extra_js[X],dataType:"script",async:F.extras.extra_js_async})}}if(F.edit.enabled){loadCSS("./scripts/CodeMirror/lib/codemirror.css");loadCSS("./scripts/CodeMirror/theme/"+F.edit.theme+".css");loadJS("./scripts/CodeMirror/lib/codemirror.js");loadJS("./scripts/CodeMirror/addon/selection/active-line.js");loadJS("./scripts/CodeMirror/dynamic-mode.js")}if(!F.options.fileRoot){fileRoot="/"+document.location.pathname.substring(1,document.location.pathname.lastIndexOf("/")+1)+"userfiles/"}else{if(!F.options.serverRoot){fileRoot=F.options.fileRoot}else{fileRoot="/"+F.options.fileRoot}fileRoot=fileRoot.replace(/\/\//g,"/")}if(F.options.relPath===false){relPath=window.location.protocol+"//"+window.location.host}else{relPath=F.options.relPath}if(C.urlParam("exclusiveFolder")!=0){fileRoot+=C.urlParam("exclusiveFolder");if(fileRoot.charAt(fileRoot.length-1)!="/"){fileRoot+="/"}fileRoot=fileRoot.replace(/\/\//g,"/")}if(C.urlParam("expandedFolder")!=0){expandedFolder=C.urlParam("expandedFolder");fullexpandedFolder=fileRoot+expandedFolder}else{expandedFolder="";fullexpandedFolder=null}if(F.options.autoload==true){C("#upload").append(E.upload);C("#newfolder").append(E.new_folder);C("#grid").attr("title",E.grid_view);C("#list").attr("title",E.list_view);C("#fileinfo h1").append(E.select_from_left);C('#itemOptions a[href$="#select"]').append(E.select);C('#itemOptions a[href$="#download"]').append(E.download);C('#itemOptions a[href$="#rename"]').append(E.rename);C('#itemOptions a[href$="#move"]').append(E.move);C('#itemOptions a[href$="#replace"]').append(E.replace);C('#itemOptions a[href$="#delete"]').append(E.del)}if(C.urlParam("CKEditorCleanUpFuncNum")){C("body").append('<button id="close-btn" type="button">'+E.close+"</button>");C("#close-btn").click(function(){parent.CKEDITOR.tools.callFunction(C.urlParam("CKEditorCleanUpFuncNum"))})}C("#browse").append("+");C("#browse").attr("title",E.browse);C("#newfile").change(function(){C("#filepath").val(C(this).val().replace(/.+[\\\/]/,""))});if(F.options.searchBox===true){loadJS("./scripts/filemanager.liveSearch.min.js")}else{C("#search").remove()}C("button").wrapInner("<span></span>");C("#fileinfo").data("view",F.options.defaultViewMode);h(F.options.defaultViewMode);C("#home").click(function(){var Y=C("#fileinfo").data("view");C("#fileinfo").data("view",Y);C("#filetree>ul>li.expanded>a").trigger("click");v(fileRoot)});C("#grid").click(function(){h("grid");C("#fileinfo").data("view","grid");v(C("#currentpath").val())});C("#list").click(function(){h("list");C("#fileinfo").data("view","list");v(C("#currentpath").val())});V(fileRoot);C("#uploader").attr("action",D);C("#uploader").ajaxForm({target:"#uploadresponse",beforeSubmit:function(Y,ac,aa){if(C("#newfile",ac).val()==""){return false}if(!H(C("#newfile",ac).val())){var ae="<p>"+E.INVALID_FILE_TYPE+"</p>";if(F.security.uploadPolicy=="DISALLOW_ALL"){ae+="<p>"+E.ALLOWED_FILE_TYPE+F.security.uploadRestrictions.join(", ")+".</p>"}if(F.security.uploadPolicy=="ALLOW_ALL"){ae+="<p>"+E.DISALLOWED_FILE_TYPE+F.security.uploadRestrictions.join(", ")+".</p>"}C("#filepath").val("");C.prompt(ae);return false}C("#upload").attr("disabled",true);C("#upload span").addClass("loading").text(E.loading_data);if(C.urlParam("type").toString().toLowerCase()=="images"){var Z=C("#newfile",ac).val().toLowerCase().split(".");var ad=false;for(key in F.images.imagesExt){if(F.images.imagesExt[key]==Z[Z.length-1]){ad=true}}if(ad===false){C.prompt(E.UPLOAD_IMAGES_ONLY);C("#upload").removeAttr("disabled").find("span").removeClass("loading").text(E.upload);return false}}if(typeof FileReader!=="undefined"&&typeof F.upload.fileSizeLimit!="auto"){var ab=C("#newfile",ac).get(0).files[0].size;if(ab>F.upload.fileSizeLimit*1024*1024){C.prompt("<p>"+E.file_too_big+"</p><p>"+E.file_size_limit+F.upload.fileSizeLimit+" "+E.mb+".</p>");C("#upload").removeAttr("disabled").find("span").removeClass("loading").text(E.upload);return false}}},error:function(Y,aa,Z){C("#upload").removeAttr("disabled").find("span").removeClass("loading").text(E.upload);C.prompt(E.ERROR_UPLOADING_FILE)},success:function(Y){var Z=jQuery.parseJSON(C("#uploadresponse").find("textarea").text());if(Z.Code==0){R(Z.Path,Z.Name);C("#filepath, #newfile").val("");if(C.browser.msie){C("#newfile").replaceWith(C("#newfile").clone(true))}C("#filetree").find('a[data-path="'+Z.Path+'/"]').click().click()}else{C.prompt(Z.Error)}C("#upload").removeAttr("disabled");C("#upload span").removeClass("loading").text(E.upload);C("#filepath").val("")}});f();if(!(window.opener||window.tinyMCEPopup||C.urlParam("field_name"))){C('#itemOptions a[href$="#select"]').remove()}if(F.options.browseOnly==true){C("#file-input-container").remove();C("#upload").remove();C("#newfolder").remove();C("#toolbar").remove("#rename");C(".contextMenu .rename").remove();C(".contextMenu .move").remove();C(".contextMenu .replace").remove();C(".contextMenu .delete").remove()}J();C(window).resize(J);C("#splitter").splitter({sizeLeft:200});n(fileRoot+expandedFolder)});var j=document.documentElement;j.setAttribute("data-useragent",navigator.userAgent)})(jQuery);